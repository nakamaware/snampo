## ファイル構成

### ルートモジュール

開発環境と本番環境でルートモジュールを分けて構成を管理。

* env/dev: 開発環境

* env/prod: 本番環境

### サブモジュール

* common

  * snampoの共通設定が入るモジュール。

* gcp

  * GCPのリソースを構成するサブモジュールが入る。

### 開発の方針

#### ルートモジュール

ルートモジュールでは開発・本番プロジェクトで共通の構成となるリソースの最低限の設定と、各環境で必要なリソースを定義する。

#### サブモジュール

開発環境と本番環境で共通するリソースを追加・削除する場合は`common`に変更を加える。個別でリソースを追加・削除する場合は`env/*`に対して変更を加える。複数のリソースの定義が必要になる場合は`gcp`などのサブモジュールを定義して呼び出すようにする。サブモジュールの追加は、公開されているモジュールで代用できない場合に限定する。サブモジュールを作成する際は、推奨設定をハードコーディングし、プロジェクトによって変更が必要な設定を変数で設定できるようにする。

### シークレットの扱い

基本的に、GCPで生成するシークレット（APIキーなど）とGCP以外のシークレット（GitHub AppsのSecretなど）の2つがある。GCPのシークレットはTerraformでシークレットを作成してSecret Managerに登録することでGCP上のリソースで利用できる。GCP以外のシークレットは`TF_VAR_{xxx}`の環境変数をGitHubリポジトリのSecretに設定して、GitHub Actionsで`terrafrom apply`する際に変数としてTerraformに注入する。
